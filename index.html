<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রো ফটো এডিটর ও ব্যাকগ্রাউন্ড রিমুভার</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f0f2f5; color: #1c1e21; scroll-behavior: smooth; }
        .cta-button { transition: all 0.2s ease; }
        .tool-button { transition: all 0.2s ease-in-out; border-bottom: 3px solid transparent; }
        .tool-button.active { color: #0d6efd; border-bottom-color: #0d6efd; }
        .tool-button:hover { background-color: #e4e6e9; }
        .color-palette-item, .bg-image-item { cursor: pointer; transition: transform 0.2s ease; border: 2px solid transparent; }
        .color-palette-item:hover, .bg-image-item:hover { transform: scale(1.05); }
        .color-palette-item.selected, .bg-image-item.selected { border-color: #0d6efd; }
        #canvas-wrapper {
            position: relative; display: flex; justify-content: center; align-items: center;
            overflow: hidden; background-color: #ffffff;
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .shadow-option { cursor: pointer; border: 1px solid #ccc; padding: 8px; border-radius: 6px; }
        .shadow-option.selected { border-color: #0d6efd; background-color: #e7f3ff; }
        .drag-over-style { border: 3px dashed #007BFF !important; background-color: #EBF8FF; }

        .processing-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.4); display: flex;
            justify-content: center; align-items: center;
            border-radius: 0.5rem; z-index: 10; overflow: hidden;
        }
        .animated-star-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .animated-star { position: absolute; background-color: white; border-radius: 50%; opacity: 0; animation: twinkle-roam 3s ease-in-out infinite; }
        @keyframes twinkle-roam {
            0% { transform: scale(0.3) translateY(0px) rotate(0deg); opacity: 0; }
            20% { opacity: 1; }
            50% { transform: scale(1.5) translateY(-50px) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0.3) translateY(-100px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600"><span>প্রো<span class="text-gray-800">এডিটর</span></span></div>
            <a href="/" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold cta-button hover:bg-blue-700">নতুন ছবি</a>
        </nav>
    </header>

    <main id="main-content" class="container mx-auto px-6 py-8">
        
        <!-- Upload Section -->
        <section id="upload-section" class="flex flex-col items-center justify-center">
            <div class="bg-white p-10 rounded-xl shadow-2xl text-center max-w-lg w-full">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">যেকোনো ছবির ব্যাকগ্রাউন্ড সরান</h1>
                <p class="text-gray-600 mb-8">এবং এডিট করুন আপনার মনের মতো করে।</p>
                <label for="image-upload" class="w-full cursor-pointer bg-blue-600 text-white px-8 py-4 rounded-lg font-bold text-lg cta-button inline-block hover:bg-blue-700">
                    কম্পিউটার থেকে আপলোড করুন
                </label>
                <input type="file" id="image-upload" class="hidden" accept="image/*">
            </div>
        </section>

        <!-- Editor Section -->
        <section id="editor-section" class="hidden mt-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Panel: Canvas -->
                <div class="lg:col-span-2 relative">
                    <div id="canvas-wrapper" class="w-full h-[70vh] rounded-lg shadow-inner">
                        <canvas id="canvas"></canvas>
                        <div id="processing-overlay" class="processing-overlay hidden">
                            <div class="animated-star-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Tools -->
                <div class="lg:col-span-1">
                    <div class="bg-white p-4 rounded-lg shadow-md mb-4 flex justify-start items-center gap-2 flex-wrap">
                        <button id="bg-tool-btn" class="tool-button active px-4 py-2 font-semibold text-gray-700 rounded-md flex items-center gap-2"><i class="fas fa-image"></i> ব্যাকগ্রাউন্ড</button>
                        <button id="shadow-tool-btn" class="tool-button px-4 py-2 font-semibold text-gray-700 rounded-md flex items-center gap-2"><i class="fas fa-moon"></i> শ্যাডো</button>
                        <button id="download-btn" class="ml-auto bg-blue-600 text-white px-6 py-2 rounded-lg font-bold cta-button hover:bg-blue-700 flex items-center gap-2"><i class="fas fa-download"></i> ডাউনলোড</button>
                    </div>

                    <div id="tool-panels">
                        <div id="background-panel" class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="font-bold text-lg mb-4">ব্যাকগ্রাউন্ড পরিবর্তন করুন</h3>
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">রঙ</h4>
                                <div class="flex flex-wrap gap-3 items-center">
                                    <div class="color-palette-item selected w-10 h-10 rounded-full border-2 border-blue-500 bg-transparent" style="background-image: url('data:image/svg+xml,%3Csvg width=\'10\' height=\'10\' viewBox=\'0 0 10 10\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M0 0L10 10M10 0L0 10\' stroke=\'%23ff0000\' stroke-width=\'1\'/%3E%3C/svg%3E');" data-bg="transparent"></div>
                                    <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #FFFFFF;" data-bg="#FFFFFF"></div>
                                    <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #000000;" data-bg="#000000"></div>
                                    <button id="random-gradient-btn" class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-yellow-500" title="Magic Background"></button>
                                    <label for="color-picker" class="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-xl">+</label>
                                    <input type="color" id="color-picker" class="invisible w-0 h-0">
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2">ছবি</h4>
                                <div class="flex flex-wrap gap-3 items-center">
                                    <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-20 w-28 object-cover rounded-lg" data-bg-src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop">
                                    <img src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-20 w-28 object-cover rounded-lg" data-bg-src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop">
                                    <label for="background-upload" class="bg-image-item h-20 w-28 rounded-lg border-2 border-dashed flex items-center justify-center cursor-pointer text-gray-400 hover:text-blue-500 hover:border-blue-500"><i class="fas fa-plus text-2xl"></i></label>
                                    <input type="file" id="background-upload" class="hidden" accept="image/*">
                                </div>
                            </div>
                        </div>
                        <div id="shadow-panel" class="hidden bg-white p-6 rounded-lg shadow-md">
                            <h3 class="font-bold text-lg mb-4">ছায়া যোগ করুন</h3>
                            <div class="flex gap-4">
                                <div class="shadow-option selected text-center" data-shadow="none"><i class="fas fa-ban text-2xl mb-2"></i><p>None</p></div>
                                <div class="shadow-option text-center" data-shadow="drop-shadow(8px 12px 10px rgba(0,0,0,0.35))"><i class="fas fa-arrow-down text-2xl mb-2"></i><p>Perspective</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DOM Element Declarations ---
            const uploadSection = document.getElementById('upload-section');
            const editorSection = document.getElementById('editor-section');
            const imageUpload = document.getElementById('image-upload');
            const processingOverlay = document.getElementById('processing-overlay');
            const animatedStarContainer = document.querySelector('.animated-star-container');
            const canvasWrapper = document.getElementById('canvas-wrapper');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const bgToolBtn = document.getElementById('bg-tool-btn');
            const shadowToolBtn = document.getElementById('shadow-tool-btn');
            const backgroundPanel = document.getElementById('background-panel');
            const shadowPanel = document.getElementById('shadow-panel');
            const downloadBtn = document.getElementById('download-btn');
            const backgroundUpload = document.getElementById('background-upload');
            const randomGradientBtn = document.getElementById('random-gradient-btn');
            const toolButtons = [bgToolBtn, shadowToolBtn];
            const toolPanels = [backgroundPanel, shadowPanel];

            // --- Global State ---
            let originalImage = null;
            let backgroundImage = null;
            let backgroundColor = 'transparent';
            let currentShadow = 'none';
            const apiKey = 'MKyYqxAq4QEoPcGSYZPUKSMK';

            // --- Core App Logic ---
            function handleFile(file) {
                if (!file || !file.type.startsWith('image/')) { alert('অনুগ্রহ করে একটি সঠিক ইমেজ ফাইল নির্বাচন করুন।'); return; }

                const originalImageReader = new FileReader();
                originalImageReader.onload = function(e) {
                    uploadSection.classList.add('hidden');
                    editorSection.classList.remove('hidden');
                    canvas.style.backgroundImage = `url(${e.target.result})`;
                    canvas.style.backgroundSize = 'contain';
                    canvas.style.backgroundRepeat = 'no-repeat';
                    canvas.style.backgroundPosition = 'center';
                    
                    processingOverlay.classList.remove('hidden');
                    generateAnimatedStars();
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    const formData = new FormData();
                    formData.append('image_file', file);
                    formData.append('size', 'auto');

                    fetch('https://api.remove.bg/v1.0/removebg', {
                        method: 'POST',
                        headers: { 'X-Api-Key': apiKey },
                        body: formData
                    })
                    .then(response => {
                        if (!response.ok) { return response.json().then(err => { const errorMsg = err.errors ? err.errors[0].title : 'একটি অজানা সমস্যা হয়েছে।'; throw new Error(errorMsg); }); }
                        return response.blob();
                    })
                    .then(blob => {
                        const processedImageReader = new FileReader();
                        processedImageReader.onloadend = () => {
                            const base64data = processedImageReader.result;
                            const img = new Image();
                            img.onload = () => {
                                originalImage = img;
                                canvas.style.backgroundImage = 'none';
                                drawCanvas();
                            };
                            img.src = base64data;
                        };
                        processedImageReader.readAsDataURL(blob);
                    })
                    .catch(error => { alert(`ত্রুটি: ${error.message}`); location.reload(); })
                    .finally(() => { stopAnimatedStars(); processingOverlay.classList.add('hidden'); imageUpload.value = ''; });
                };
                originalImageReader.readAsDataURL(file);
            }

            imageUpload.addEventListener('change', (e) => handleFile(e.target.files[0]));

            // --- Canvas Drawing Logic ---
            function drawCanvas() {
                if (!originalImage) return;
                const wrapperWidth = canvasWrapper.clientWidth; const wrapperHeight = canvasWrapper.clientHeight;
                const imgAspectRatio = originalImage.width / originalImage.height; const wrapperAspectRatio = wrapperWidth / wrapperHeight;
                let drawWidth, drawHeight;
                if (imgAspectRatio > wrapperAspectRatio) { drawWidth = wrapperWidth * 0.9; drawHeight = drawWidth / imgAspectRatio; }
                else { drawHeight = wrapperHeight * 0.9; drawWidth = drawHeight * imgAspectRatio; }
                canvas.width = wrapperWidth; canvas.height = wrapperHeight;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (backgroundImage) { ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height); }
                else if (backgroundColor !== 'transparent') {
                    if(typeof backgroundColor === 'object') { // Gradient
                        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                        gradient.addColorStop(0, backgroundColor.color1);
                        gradient.addColorStop(1, backgroundColor.color2);
                        ctx.fillStyle = gradient;
                    } else {
                        ctx.fillStyle = backgroundColor;
                    }
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
                ctx.filter = currentShadow;
                const x = (canvas.width - drawWidth) / 2;
                const y = (canvas.height - drawHeight) / 2;
                ctx.drawImage(originalImage, x, y, drawWidth, drawHeight);
                ctx.filter = 'none';
            }

            // --- Editor Controls ---
            function switchTool(activeBtn, activePanel) {
                toolButtons.forEach(btn => btn.classList.remove('active'));
                toolPanels.forEach(panel => panel.style.display = 'none');
                activeBtn.classList.add('active');
                activePanel.style.display = 'block';
            }
            bgToolBtn.addEventListener('click', () => switchTool(bgToolBtn, backgroundPanel));
            shadowToolBtn.addEventListener('click', () => {
                // Manually hide/show because they are inside the same parent div now
                backgroundPanel.style.display = 'none';
                shadowPanel.style.display = 'block';
                bgToolBtn.classList.remove('active');
                shadowToolBtn.classList.add('active');
            });
            // Initial state
            shadowPanel.style.display = 'none';

            function updateSelection(selectedElement, panelSelector) {
                document.querySelectorAll(panelSelector).forEach(el => el.classList.remove('selected'));
                if (selectedElement) selectedElement.classList.add('selected');
            }
            document.querySelectorAll('.color-palette-item').forEach(item => {
                item.addEventListener('click', () => { backgroundColor = item.dataset.bg; backgroundImage = null; updateSelection(item, '.color-palette-item, .bg-image-item'); drawCanvas(); });
            });
            document.getElementById('color-picker').addEventListener('input', (e) => { backgroundColor = e.target.value; backgroundImage = null; updateSelection(null, '.color-palette-item, .bg-image-item'); drawCanvas(); });
            randomGradientBtn.addEventListener('click', () => {
                const getRandomColor = () => `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`;
                backgroundColor = { color1: getRandomColor(), color2: getRandomColor() };
                backgroundImage = null;
                updateSelection(null, '.color-palette-item, .bg-image-item');
                drawCanvas();
            });
            document.querySelectorAll('.bg-image-item').forEach(item => {
                item.addEventListener('click', () => { const bgImg = new Image(); bgImg.crossOrigin = "Anonymous"; bgImg.onload = () => { backgroundImage = bgImg; backgroundColor = 'transparent'; updateSelection(item, '.bg-image-item, .color-palette-item'); drawCanvas(); }; bgImg.src = item.dataset.bgSrc; });
            });
            backgroundUpload.addEventListener('change', (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => { const bgImg = new Image(); bgImg.onload = () => { backgroundImage = bgImg; backgroundColor = 'transparent'; updateSelection(null, '.bg-image-item, .color-palette-item'); drawCanvas(); }; bgImg.src = event.target.result; };
                reader.readAsDataURL(file);
            });
            document.querySelectorAll('.shadow-option').forEach(option => {
                option.addEventListener('click', () => { currentShadow = option.dataset.shadow; updateSelection(option, '.shadow-option'); drawCanvas(); });
            });
            downloadBtn.addEventListener('click', () => { const link = document.createElement('a'); link.download = 'edited-image.png'; link.href = canvas.toDataURL('image/png'); link.click(); });
            window.addEventListener('resize', drawCanvas);

            // --- Animation Logic ---
            const starColors = ['#FFFFFF', '#FFD700', '#FFA07A', '#87CEEB', '#98FB98', '#FF69B4'];
            function generateAnimatedStars() {
                animatedStarContainer.innerHTML = ''; 
                for (let i = 0; i < 60; i++) {
                    const star = document.createElement('div');
                    star.className = 'animated-star';
                    const size = Math.random() * 12 + 6;
                    star.style.width = `${size}px`; star.style.height = `${size}px`;
                    star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 100}%`;
                    star.style.animationDelay = `${Math.random() * 3}s`; star.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    const starColor = starColors[Math.floor(Math.random() * starColors.length)];
                    star.style.backgroundColor = starColor; star.style.boxShadow = `0 0 8px ${starColor}, 0 0 15px ${starColor}`;
                    animatedStarContainer.appendChild(star);
                }
            }
            function stopAnimatedStars() { animatedStarContainer.innerHTML = ''; }
        });
    </script>
</body>
</html>

