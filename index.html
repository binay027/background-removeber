<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ফটো এডিটর ও ব্যাকগ্রাউন্ড রিমুভার</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f0f2f5; color: #1c1e21; scroll-behavior: smooth; }
        .editor-bg { background-color: #e9ebee; }
        .cta-button { transition: all 0.2s ease; }
        .tool-button {
            transition: all 0.2s ease-in-out;
            border-bottom: 3px solid transparent;
        }
        .tool-button.active {
            color: #0d6efd;
            border-bottom-color: #0d6efd;
        }
        .tool-button:hover { background-color: #e4e6e9; }
        .color-palette-item, .bg-image-item {
            cursor: pointer;
            transition: transform 0.2s ease;
            border: 2px solid transparent;
        }
        .color-palette-item:hover, .bg-image-item:hover { transform: scale(1.05); }
        .color-palette-item.selected, .bg-image-item.selected { border-color: #0d6efd; }
        #canvas-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: #ffffff;
            background-image:
                linear-gradient(45deg, #ccc 25%, transparent 25%),
                linear-gradient(-45deg, #ccc 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #ccc 75%),
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        #canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .shadow-option {
            cursor: pointer;
            border: 1px solid #ccc;
            padding: 8px;
            border-radius: 6px;
        }
         .shadow-option.selected {
            border-color: #0d6efd;
            background-color: #e7f3ff;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600"><span>প্রো<span class="text-gray-800">এডিটর</span></span></div>
            <a href="/" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold cta-button hover:bg-blue-700">নতুন ছবি</a>
        </nav>
    </header>

    <main id="main-content">
        <!-- Initial Upload Section -->
        <section id="upload-section" class="flex flex-col items-center justify-center min-h-[calc(100vh-80px)]">
            <div class="bg-white p-10 rounded-xl shadow-2xl text-center max-w-lg w-full">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">যেকোনো ছবির ব্যাকগ্রাউন্ড সরান</h1>
                <p class="text-gray-600 mb-8">এবং এডিট করুন আপনার মনের মতো করে।</p>
                <label for="image-upload" class="w-full cursor-pointer bg-blue-600 text-white px-8 py-4 rounded-lg font-bold text-lg cta-button inline-block hover:bg-blue-700">
                    কম্পিউটার থেকে আপলোড করুন
                </label>
                <input type="file" id="image-upload" class="hidden" accept="image/*">
                 <div id="loading" class="mt-8 hidden flex-col items-center">
                    <div class="w-16 h-16 border-4 border-blue-500 border-dashed rounded-full animate-spin"></div>
                    <p class="text-gray-600 mt-4">ছবি প্রসেস করা হচ্ছে...</p>
                </div>
            </div>
        </section>

        <!-- Editor Section -->
        <section id="editor-section" class="hidden editor-bg py-8">
            <div class="container mx-auto px-6">
                <!-- Toolbar -->
                <div class="bg-white p-3 rounded-lg shadow-md mb-6 flex justify-center items-center gap-4 flex-wrap">
                    <button id="bg-tool-btn" class="tool-button active px-4 py-2 font-semibold text-gray-700 rounded-md flex items-center gap-2"><i class="fas fa-image"></i> ব্যাকগ্রাউন্ড</button>
                    <button id="shadow-tool-btn" class="tool-button px-4 py-2 font-semibold text-gray-700 rounded-md flex items-center gap-2"><i class="fas fa-moon"></i> শ্যাডো</button>
                    <!-- More tools can be added here -->
                    <div class="flex-grow"></div>
                    <button id="download-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold cta-button hover:bg-blue-700 flex items-center gap-2"><i class="fas fa-download"></i> ডাউনলোড</button>
                </div>

                <!-- Tool Panels -->
                <div id="tool-panels" class="mb-6">
                    <!-- Background Panel -->
                    <div id="background-panel" class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-4">ব্যাকগ্রাউন্ড পরিবর্তন করুন</h3>
                        <div class="mb-4">
                            <h4 class="font-semibold mb-2">রঙ</h4>
                            <div class="flex flex-wrap gap-3 items-center">
                                <div class="color-palette-item selected w-10 h-10 rounded-full border-2 border-blue-500 bg-transparent" style="background-image: url('data:image/svg+xml,%3Csvg width=\'10\' height=\'10\' viewBox=\'0 0 10 10\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M0 0L10 10M10 0L0 10\' stroke=\'%23ff0000\' stroke-width=\'1\'/%3E%3C/svg%3E');" data-bg="transparent"></div>
                                <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #FFFFFF;" data-bg="#FFFFFF"></div>
                                <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #000000;" data-bg="#000000"></div>
                                <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #EF4444;" data-bg="#EF4444"></div>
                                <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #3B82F6;" data-bg="#3B82F6"></div>
                                <div class="color-palette-item w-10 h-10 rounded-full" style="background-color: #22C55E;" data-bg="#22C55E"></div>
                                <label for="color-picker" class="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-xl">+</label>
                                <input type="color" id="color-picker" class="invisible w-0 h-0">
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">ছবি</h4>
                            <div class="flex flex-wrap gap-3">
                                <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-20 w-28 object-cover rounded-lg" data-bg-src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop">
                                <img src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-20 w-28 object-cover rounded-lg" data-bg-src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop">
                                <img src="https://images.unsplash.com/photo-1553095066-5014bc7b7f2d?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-20 w-28 object-cover rounded-lg" data-bg-src="https://images.unsplash.com/photo-1553095066-5014bc7b7f2d?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop">
                            </div>
                        </div>
                    </div>
                    <!-- Shadow Panel -->
                    <div id="shadow-panel" class="hidden bg-white p-6 rounded-lg shadow-md">
                        <h3 class="font-bold text-lg mb-4">ছায়া যোগ করুন</h3>
                        <div class="flex gap-4">
                            <div class="shadow-option selected text-center" data-shadow="none">
                                <i class="fas fa-ban text-2xl mb-2"></i>
                                <p>None</p>
                            </div>
                            <div class="shadow-option text-center" data-shadow="drop-shadow(5px 10px 8px rgba(0,0,0,0.4))">
                               <i class="fas fa-arrow-down text-2xl mb-2"></i>
                                <p>Perspective</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Canvas -->
                <div id="canvas-wrapper" class="w-full h-[60vh] rounded-lg shadow-inner">
                    <canvas id="canvas"></canvas>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const uploadSection = document.getElementById('upload-section');
            const editorSection = document.getElementById('editor-section');
            const imageUpload = document.getElementById('image-upload');
            const loading = document.getElementById('loading');
            const downloadBtn = document.getElementById('download-btn');

            const canvasWrapper = document.getElementById('canvas-wrapper');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            let originalImage = null; // Original image without background
            let backgroundImage = null;
            let backgroundColor = 'transparent';
            let currentShadow = 'none';

            const apiKey = 'MKyYqxAq4QEoPcGSYZPUKSMK';

            // --- Tool Switching Logic ---
            const bgToolBtn = document.getElementById('bg-tool-btn');
            const shadowToolBtn = document.getElementById('shadow-tool-btn');
            const backgroundPanel = document.getElementById('background-panel');
            const shadowPanel = document.getElementById('shadow-panel');
            const toolButtons = [bgToolBtn, shadowToolBtn];
            const toolPanels = [backgroundPanel, shadowPanel];

            function switchTool(activeBtn, activePanel) {
                toolButtons.forEach(btn => btn.classList.remove('active'));
                toolPanels.forEach(panel => panel.classList.add('hidden'));
                activeBtn.classList.add('active');
                activePanel.classList.remove('hidden');
            }

            bgToolBtn.addEventListener('click', () => switchTool(bgToolBtn, backgroundPanel));
            shadowToolBtn.addEventListener('click', () => switchTool(shadowToolBtn, shadowPanel));
            
            // --- Image Upload & Processing ---
            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                uploadSection.querySelector('label').classList.add('hidden');
                loading.classList.remove('hidden');

                const formData = new FormData();
                formData.append('image_file', file);
                formData.append('size', 'auto');

                fetch('https://api.remove.bg/v1.0/removebg', {
                    method: 'POST',
                    headers: { 'X-Api-Key': apiKey },
                    body: formData
                })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.blob();
                })
                .then(blob => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            originalImage = img;
                            uploadSection.classList.add('hidden');
                            editorSection.classList.remove('hidden');
                            drawCanvas();
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(blob);
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ব্যাকগ্রাউন্ড সরাতে সমস্যা হয়েছে।');
                    uploadSection.querySelector('label').classList.remove('hidden');
                    loading.classList.add('hidden');
                });
            });

            // --- Drawing Logic ---
            function drawCanvas() {
                if (!originalImage) return;

                // Fit image within the wrapper while maintaining aspect ratio
                const wrapperWidth = canvasWrapper.clientWidth;
                const wrapperHeight = canvasWrapper.clientHeight;
                const imgAspectRatio = originalImage.width / originalImage.height;
                const wrapperAspectRatio = wrapperWidth / wrapperHeight;

                let drawWidth, drawHeight;
                if (imgAspectRatio > wrapperAspectRatio) {
                    drawWidth = wrapperWidth * 0.8;
                    drawHeight = drawWidth / imgAspectRatio;
                } else {
                    drawHeight = wrapperHeight * 0.8;
                    drawWidth = drawHeight * imgAspectRatio;
                }
                
                canvas.width = wrapperWidth;
                canvas.height = wrapperHeight;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw background
                if (backgroundImage) {
                    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                } else if (backgroundColor !== 'transparent') {
                    ctx.fillStyle = backgroundColor;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // Draw foreground image
                ctx.filter = currentShadow;
                ctx.drawImage(originalImage, 0, 0, drawWidth, drawHeight);
                ctx.filter = 'none'; // Reset filter
            }

            // --- Background Controls ---
            const colorPaletteItems = document.querySelectorAll('.color-palette-item');
            const colorPicker = document.getElementById('color-picker');
            const bgImageItems = document.querySelectorAll('.bg-image-item');

            function updateBgSelection(selectedElement, panelSelector) {
                 document.querySelectorAll(panelSelector).forEach(el => el.classList.remove('selected'));
                 selectedElement.classList.add('selected');
            }

            colorPaletteItems.forEach(item => {
                item.addEventListener('click', () => {
                    backgroundColor = item.dataset.bg;
                    backgroundImage = null;
                    updateBgSelection(item, '.color-palette-item');
                    drawCanvas();
                });
            });
            
            colorPicker.addEventListener('input', (e) => {
                 backgroundColor = e.target.value;
                 backgroundImage = null;
                 // Deselect all other colors
                 document.querySelectorAll('.color-palette-item').forEach(el => el.classList.remove('selected'));
                 drawCanvas();
            });

            bgImageItems.forEach(item => {
                item.addEventListener('click', () => {
                    const bgImg = new Image();
                    bgImg.crossOrigin = "Anonymous"; // Important for canvas
                    bgImg.onload = () => {
                        backgroundImage = bgImg;
                        backgroundColor = 'transparent';
                        updateBgSelection(item, '.bg-image-item');
                        drawCanvas();
                    };
                    bgImg.src = item.dataset.bgSrc;
                });
            });
            
            // --- Shadow Controls ---
            const shadowOptions = document.querySelectorAll('.shadow-option');
            shadowOptions.forEach(option => {
                option.addEventListener('click', () => {
                    currentShadow = option.dataset.shadow;
                    updateBgSelection(option, '.shadow-option');
                    drawCanvas();
                });
            });

            // --- Download Logic ---
            downloadBtn.addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = 'edited-image.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
            
            // Redraw canvas on window resize
            window.addEventListener('resize', drawCanvas);
        });
    </script>
</body>
</html>

