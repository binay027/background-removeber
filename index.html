<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßç‡¶∞‡ßã ‡¶´‡¶ü‡ßã ‡¶è‡¶°‡¶ø‡¶ü‡¶∞ ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠‡¶æ‡¶∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f0f2f5; color: #1c1e21; scroll-behavior: smooth; }
        .gradient-bg { background: linear-gradient(135deg, #E0F7FA 0%, #FFFFFF 100%); }
        .cta-button { transition: all 0.2s ease; }
        .tool-button { transition: all 0.2s ease-in-out; border-bottom: 3px solid transparent; }
        .tool-button.active { color: #0d6efd; border-bottom-color: #0d6efd; }
        .tool-button:hover { background-color: #e4e6e9; }
        .color-palette-item, .bg-image-item { cursor: pointer; transition: transform 0.2s ease; border: 2px solid transparent; }
        .color-palette-item:hover, .bg-image-item:hover { transform: scale(1.05); }
        .color-palette-item.selected, .bg-image-item.selected { border-color: #0d6efd; }
        #canvas-wrapper {
            position: relative; display: flex; justify-content: center; align-items: center;
            overflow: hidden; background-color: #ffffff;
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .shadow-option { cursor: pointer; border: 1px solid #ccc; padding: 8px; border-radius: 6px; }
        .shadow-option.selected { border-color: #0d6efd; background-color: #e7f3ff; }
        .drag-over-style { border: 3px dashed #007BFF !important; background-color: #EBF8FF; }
        .history-thumbnail { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid #e2e8f0; transition: all 0.2s ease-in-out; }
        .history-thumbnail:hover { border-color: #3498db; transform: scale(1.05); }

        .processing-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.4); display: flex;
            justify-content: center; align-items: center;
            border-radius: 0.5rem; z-index: 10; overflow: hidden;
        }
        .animated-star-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .animated-star { position: absolute; background-color: white; border-radius: 50%; opacity: 0; animation: twinkle-roam 3s ease-in-out infinite; }
        @keyframes twinkle-roam {
            0% { transform: scale(0.3) translateY(0px) rotate(0deg); opacity: 0; }
            20% { opacity: 1; }
            50% { transform: scale(1.5) translateY(-50px) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0.3) translateY(-100px) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600"><span>‡¶™‡ßç‡¶∞‡ßã<span class="text-gray-800">‡¶è‡¶°‡¶ø‡¶ü‡¶∞</span></span></div>
            <div id="landing-menu" class="hidden md:flex space-x-6 items-center">
                <a href="#features" class="text-gray-600 hover:text-blue-600 transition">‡¶´‡¶ø‡¶ö‡¶æ‡¶∞</a>
                <a href="#how-it-works" class="text-gray-600 hover:text-blue-600 transition">‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá</a>
                <a href="#history-section" class="text-gray-600 hover:text-blue-600 transition">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú</a>
                <a href="#faq" class="text-gray-600 hover:text-blue-600 transition">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶æ‡¶¨‡¶≤‡ßÄ</a>
            </div>
            <button id="header-action-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold cta-button hover:bg-blue-700">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </nav>
    </header>

    <main id="main-content" class="container mx-auto px-6 py-8">
        
        <section id="upload-section">
            <div id="drop-zone" class="gradient-bg pt-20 pb-24 text-center border-4 border-dashed border-transparent rounded-xl">
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 leading-tight mb-4">‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶∞‡¶æ‡¶® ‡¶ì ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">‡¶è‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßÇ‡¶™ ‡¶¶‡¶ø‡¶®‡•§</p>
                <label for="image-upload" class="w-full sm:w-auto cursor-pointer bg-blue-600 text-white px-8 py-4 rounded-lg font-bold text-lg cta-button inline-block">
                    ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                </label>
                <input type="file" id="image-upload" class="hidden" accept="image/*">
                <p class="text-gray-500 text-sm mt-4">‡¶Ö‡¶•‡¶¨‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ü‡ßá‡¶®‡ßá ‡¶Ü‡¶®‡ßÅ‡¶®</p>
            </div>
        </section>

        <section id="editor-section" class="hidden">
            <!-- This section's content is generated dynamically by JS -->
        </section>

        <div id="info-sections">
            <section id="history-section" class="py-12 bg-gray-50 rounded-xl mt-8"><div class="container mx-auto px-6 text-center"><h2 class="text-3xl font-bold text-gray-800 mb-6">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú</h2><div id="history-container" class="flex gap-4 justify-center flex-wrap"></div></div></section>
            <section id="how-it-works" class="py-20 bg-white mt-8 rounded-xl"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-gray-800">‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ß©‡¶ü‡¶ø ‡¶∏‡¶π‡¶ú ‡¶ß‡¶æ‡¶™‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá</h2></div><div class="grid grid-cols-1 md:grid-cols-3 gap-10 text-center"><div class="p-6"><div class="flex items-center justify-center h-20 w-20 mx-auto bg-blue-100 text-blue-600 rounded-full text-4xl mb-4">üì§</div><h3 class="text-xl font-semibold mb-2">‡ßß. ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h3><p class="text-gray-500">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®‡•§</p></div><div class="p-6"><div class="flex items-center justify-center h-20 w-20 mx-auto bg-green-100 text-green-600 rounded-full text-4xl mb-4">‚ú®</div><h3 class="text-xl font-semibold mb-2">‡ß®. AI ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç</h3><p class="text-gray-500">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü AI ‡¶ï‡¶Ø‡¶º‡ßá‡¶ï ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§</p></div><div class="p-6"><div class="flex items-center justify-center h-20 w-20 mx-auto bg-purple-100 text-purple-600 rounded-full text-4xl mb-4">üì•</div><h3 class="text-xl font-semibold mb-2">‡ß©. ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ì ‡¶è‡¶°‡¶ø‡¶ü</h3><p class="text-gray-500">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶è‡¶°‡¶ø‡¶ü‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßÇ‡¶™ ‡¶¶‡¶ø‡¶®‡•§</p></div></div></div></section>
            <section id="features" class="py-20 bg-gray-50 mt-8 rounded-xl"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-gray-800">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π</h2></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><div class="bg-white p-6 rounded-lg shadow-md feature-card"><h3 class="text-xl font-semibold mb-2">‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶è‡¶°‡¶ø‡¶ü‡¶∞</h3><p class="text-gray-600">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ô, ‡¶õ‡¶¨‡¶ø ‡¶¨‡¶æ ‡¶∂‡ßç‡¶Ø‡¶æ‡¶°‡ßã ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá ‡¶õ‡¶¨‡¶ø‡¶ï‡ßá ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡ßü ‡¶ï‡¶∞‡ßá ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®‡•§</p></div><div class="bg-white p-6 rounded-lg shadow-md feature-card"><h3 class="text-xl font-semibold mb-2">‡¶â‡¶ö‡ßç‡¶ö-‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü</h3><p class="text-gray-600">‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶æ‡¶® ‡¶®‡¶æ ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá ‡¶π‡¶æ‡¶á-‡¶∞‡ßá‡¶ú‡ßã‡¶≤‡¶ø‡¶â‡¶∂‡¶®‡ßá ‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°‡¶∏‡¶π ‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div><div class="bg-white p-6 rounded-lg shadow-md feature-card"><h3 class="text-xl font-semibold mb-2">‡¶∏‡¶Æ‡ßü ‡¶∏‡¶æ‡¶∂‡ßç‡¶∞‡ßü‡ßÄ</h3><p class="text-gray-600">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü‡¶ø‡¶Ç-‡¶è‡¶∞ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶¨‡¶æ‡¶Å‡¶ö‡¶ø‡ßü‡ßá ‡¶ï‡ßü‡ßá‡¶ï ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡¶æ‡¶®‡•§</p></div></div></div></section>
            <section id="faq" class="py-20 bg-white mt-8 rounded-xl"><div class="container mx-auto px-6 max-w-3xl"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold text-gray-800">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ (FAQ)</h2></div><div class="space-y-4"><div class="bg-white rounded-lg shadow-sm"><button class="faq-question w-full flex justify-between items-center text-left p-5 font-semibold text-lg focus:outline-none"><span>‡¶è‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶ü‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶¨‡¶ø‡¶®‡¶æ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá?</span><span class="faq-arrow transform transition-transform duration-300">‚ñº</span></button><div class="faq-answer hidden p-5 pt-0 text-gray-600">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶ü‡¶ø ‡¶¨‡¶ø‡¶®‡¶æ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá‡•§ remove.bg API ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ï‡ßã‡¶ü‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶Ø‡¶æ ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü‡•§</div></div><div class="bg-white rounded-lg shadow-sm"><button class="faq-question w-full flex justify-between items-center text-left p-5 font-semibold text-lg focus:outline-none"><span>‡¶Ü‡¶Æ‡¶ø ‡¶ï‡ßã‡¶® ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?</span><span class="faq-arrow transform transition-transform duration-300">‚ñº</span></button><div class="faq-answer hidden p-5 pt-0 text-gray-600">‡¶Ü‡¶™‡¶®‡¶ø ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑, ‡¶™‡¶£‡ßç‡¶Ø, ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßÄ, ‡¶ó‡¶æ‡¶°‡¶º‡¶ø, ‡¶¨‡¶æ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶∏‡ßç‡¶§‡ßÅ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§ ‡¶∏‡ßá‡¶∞‡¶æ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø, ‡¶õ‡¶¨‡¶ø‡¶ü‡¶ø ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶≠‡¶æ‡¶≤‡ßã‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶≤‡ßã‡¶ï‡¶ø‡¶§ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶â‡¶ö‡¶ø‡¶§‡•§</div></div></div></div></section>
        </div>
    </main>
    <footer class="bg-gray-800 text-white py-12 mt-8"><div class="container mx-auto px-6 text-center"><p>&copy; ‡ß®‡ß¶‡ß®‡ß´ ‡¶™‡ßç‡¶∞‡ßã‡¶è‡¶°‡¶ø‡¶ü‡¶∞‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§</p></div></footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DOM Element Declarations ---
            const uploadSection = document.getElementById('upload-section');
            const editorSection = document.getElementById('editor-section');
            const infoSections = document.getElementById('info-sections');
            const dropZone = document.getElementById('drop-zone');
            const imageUpload = document.getElementById('image-upload');
            const historyContainer = document.getElementById('history-container');
            const headerActionBtn = document.getElementById('header-action-btn');
            const landingMenu = document.getElementById('landing-menu');
            
            // --- Global State ---
            let originalImage = null;
            let backgroundImage = null;
            let backgroundColor = 'transparent';
            let currentShadow = 'none';
            const apiKey = 'MKyYqxAq4QEoPcGSYZPUKSMK';

            // --- UI View Management ---
            function showLandingView() {
                editorSection.classList.add('hidden');
                uploadSection.classList.remove('hidden');
                infoSections.classList.remove('hidden');
                landingMenu.style.display = 'flex';
                headerActionBtn.textContent = '‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®';
                headerActionBtn.onclick = null; // Reset
                renderHistory();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function showEditorView() {
                uploadSection.classList.add('hidden');
                infoSections.classList.add('hidden');
                editorSection.classList.remove('hidden');
                landingMenu.style.display = 'none';
                headerActionBtn.textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶õ‡¶¨‡¶ø';
                headerActionBtn.onclick = showLandingView;
                
                // Inject editor HTML
                editorSection.innerHTML = `
                    <div class="relative max-w-4xl mx-auto mb-6">
                        <img id="processing-image-preview" src="" alt="‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â" class="mx-auto rounded-lg max-h-[70vh] shadow-lg">
                        <div id="processing-animation-overlay" class="processing-overlay hidden rounded-lg">
                            <div class="animated-star-container"></div>
                        </div>
                    </div>
                    <div id="editor-ui" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 relative">
                            <div id="canvas-wrapper" class="w-full h-[50vh] lg:h-[60vh] rounded-lg shadow-inner">
                                <canvas id="canvas"></canvas>
                            </div>
                        </div>
                        <div class="lg:col-span-1">
                            <div class="bg-white p-3 rounded-lg shadow-md mb-4 flex justify-start items-center gap-2 flex-wrap">
                                <button id="bg-tool-btn" class="tool-button active px-3 py-2 font-semibold text-sm text-gray-700 rounded-md flex items-center gap-2"><i class="fas fa-image"></i> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°</button>
                                <button id="shadow-tool-btn" class="tool-button px-3 py-2 font-semibold text-sm text-gray-700 rounded-md flex items-center gap-2"><i class="fas fa-moon"></i> ‡¶∂‡ßç‡¶Ø‡¶æ‡¶°‡ßã</button>
                                <button id="download-btn" class="ml-auto bg-blue-600 text-white px-4 py-2 rounded-lg font-bold cta-button text-sm hover:bg-blue-700 flex items-center gap-2"><i class="fas fa-download"></i> ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                            </div>
                            <div id="tool-panels">
                                <div id="background-panel" class="bg-white p-4 rounded-lg shadow-md"><h3 class="font-bold text-md mb-4">‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3><div class="mb-4"><h4 class="font-semibold text-sm mb-2">‡¶∞‡¶ô</h4><div class="flex flex-wrap gap-3 items-center"><div class="color-palette-item selected w-8 h-8 rounded-full" data-bg="transparent" style="background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%); background-size: 10px 10px;"></div><div class="color-palette-item w-8 h-8 rounded-full" style="background-color: #FFFFFF;" data-bg="#FFFFFF"></div><div class="color-palette-item w-8 h-8 rounded-full" style="background-color: #000000;" data-bg="#000000"></div><button id="random-gradient-btn" class="w-8 h-8 rounded-full bg-gradient-to-r from-pink-500 to-yellow-500" title="Magic Background"></button><label for="color-picker" class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer text-lg">+</label><input type="color" id="color-picker" class="invisible w-0 h-0"></div></div><div><h4 class="font-semibold text-sm mb-2">‡¶õ‡¶¨‡¶ø</h4><div class="flex flex-wrap gap-3 items-center"><img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-16 w-24 object-cover rounded-md" data-bg-src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop"><img src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?ixlib=rb-4.0.3&q=80&w=200&auto=format&fit=crop" class="bg-image-item h-16 w-24 object-cover rounded-md" data-bg-src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?ixlib=rb-4.0.3&q=80&w=1920&auto=format&fit=crop"><label for="background-upload" class="bg-image-item h-16 w-24 rounded-md border-2 border-dashed flex items-center justify-center cursor-pointer text-gray-400 hover:text-blue-500 hover:border-blue-500"><i class="fas fa-plus text-xl"></i></label><input type="file" id="background-upload" class="hidden" accept="image/*"></div></div></div>
                                <div id="shadow-panel" class="hidden bg-white p-4 rounded-lg shadow-md"><h3 class="font-bold text-md mb-4">‡¶õ‡¶æ‡ßü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3><div class="flex gap-4"><div class="shadow-option selected text-center" data-shadow="none"><i class="fas fa-ban text-xl mb-1"></i><p class="text-xs">None</p></div><div class="shadow-option text-center" data-shadow="drop-shadow(8px 12px 10px rgba(0,0,0,0.35))"><i class="fas fa-arrow-down text-xl mb-1"></i><p class="text-xs">Perspective</p></div></div></div>
                            </div>
                        </div>
                    </div>
                `;
                setupEditorEventListeners();
            }
            
            // --- File Handling ---
            function handleFile(file) {
                if (!file || !file.type.startsWith('image/')) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶á‡¶Æ‡ßá‡¶ú ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; }

                showEditorView(); // Immediately switch to editor shell
                const processingImagePreview = document.getElementById('processing-image-preview');
                const processingAnimationOverlay = document.getElementById('processing-animation-overlay');
                
                const originalImageReader = new FileReader();
                originalImageReader.onload = function(e) {
                    processingImagePreview.src = e.target.result;
                    processingAnimationOverlay.classList.remove('hidden');
                    generateAnimatedStars();
                    
                    const formData = new FormData();
                    formData.append('image_file', file);
                    formData.append('size', 'auto');

                    fetch('https://api.remove.bg/v1.0/removebg', {
                        method: 'POST',
                        headers: { 'X-Api-Key': apiKey },
                        body: formData
                    })
                    .then(response => {
                        if (!response.ok) { return response.json().then(err => { const errorMsg = err.errors ? err.errors[0].title : '‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§'; throw new Error(errorMsg); }); }
                        return response.blob();
                    })
                    .then(blob => {
                        const processedImageReader = new FileReader();
                        processedImageReader.onloadend = () => {
                            const base64data = processedImageReader.result;
                            const img = new Image();
                            img.onload = () => {
                                originalImage = img;
                                saveToHistory(base64data);
                                processingImagePreview.classList.add('hidden');
                                processingAnimationOverlay.classList.add('hidden');
                                stopAnimatedStars();
                                document.getElementById('editor-ui').classList.remove('hidden');
                                drawCanvas();
                            };
                            img.src = base64data;
                        };
                        processedImageReader.readAsDataURL(blob);
                    })
                    .catch(error => { alert(`‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`); showLandingView(); });
                };
                originalImageReader.readAsDataURL(file);
            }
            imageUpload.addEventListener('change', (e) => handleFile(e.target.files[0]));
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('drag-over-style'); });
            dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over-style'); });
            dropZone.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('drag-over-style'); handleFile(e.dataTransfer.files[0]); });

            // --- Editor Setup ---
            function setupEditorEventListeners() {
                const canvas = document.getElementById('canvas');
                if(!canvas) return; // Guard clause
                const ctx = canvas.getContext('2d');
                const bgToolBtn = document.getElementById('bg-tool-btn');
                const shadowToolBtn = document.getElementById('shadow-tool-btn');
                const backgroundPanel = document.getElementById('background-panel');
                const shadowPanel = document.getElementById('shadow-panel');
                const downloadBtn = document.getElementById('download-btn');
                const backgroundUpload = document.getElementById('background-upload');
                const randomGradientBtn = document.getElementById('random-gradient-btn');

                function drawCanvas() {
                    if (!originalImage) return;
                    const canvasWrapper = document.getElementById('canvas-wrapper');
                    const wrapperWidth = canvasWrapper.clientWidth; const wrapperHeight = canvasWrapper.clientHeight;
                    const imgAspectRatio = originalImage.width / originalImage.height; const wrapperAspectRatio = wrapperWidth / wrapperHeight;
                    let drawWidth, drawHeight;
                    if (imgAspectRatio > wrapperAspectRatio) { drawWidth = wrapperWidth * 0.9; drawHeight = drawWidth / imgAspectRatio; } 
                    else { drawHeight = wrapperHeight * 0.9; drawWidth = drawHeight * imgAspectRatio; }
                    canvas.width = wrapperWidth; canvas.height = wrapperHeight;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    if (backgroundImage) { ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height); } 
                    else if (backgroundColor !== 'transparent') {
                        if (typeof backgroundColor === 'object') {
                            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                            gradient.addColorStop(0, backgroundColor.color1); gradient.addColorStop(1, backgroundColor.color2);
                            ctx.fillStyle = gradient;
                        } else { ctx.fillStyle = backgroundColor; }
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                    ctx.filter = currentShadow;
                    const x = (canvas.width - drawWidth) / 2;
                    const y = (canvas.height - drawHeight) / 2;
                    ctx.drawImage(originalImage, x, y, drawWidth, drawHeight);
                    ctx.filter = 'none';
                }
                window.drawCanvas = drawCanvas; // Make it globally accessible for resize

                function switchTool(activeBtn) {
                    if (activeBtn === bgToolBtn) {
                        backgroundPanel.style.display = 'block'; shadowPanel.style.display = 'none';
                        bgToolBtn.classList.add('active'); shadowToolBtn.classList.remove('active');
                    } else {
                        backgroundPanel.style.display = 'none'; shadowPanel.style.display = 'block';
                        bgToolBtn.classList.remove('active'); shadowToolBtn.classList.add('active');
                    }
                }
                bgToolBtn.addEventListener('click', () => switchTool(bgToolBtn));
                shadowToolBtn.addEventListener('click', () => switchTool(shadowToolBtn));

                function updateSelection(selectedElement, panelSelector) {
                    document.querySelectorAll(panelSelector).forEach(el => el.classList.remove('selected'));
                    if (selectedElement) selectedElement.classList.add('selected');
                }
                document.querySelectorAll('.color-palette-item').forEach(item => {
                    item.addEventListener('click', () => { backgroundColor = item.dataset.bg; backgroundImage = null; updateSelection(item, '.color-palette-item, .bg-image-item'); drawCanvas(); });
                });
                document.getElementById('color-picker').addEventListener('input', (e) => { backgroundColor = e.target.value; backgroundImage = null; updateSelection(null, '.color-palette-item, .bg-image-item'); drawCanvas(); });
                randomGradientBtn.addEventListener('click', () => {
                    const getRandomColor = () => `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`;
                    backgroundColor = { color1: getRandomColor(), color2: getRandomColor() };
                    backgroundImage = null;
                    updateSelection(null, '.color-palette-item, .bg-image-item'); drawCanvas();
                });
                document.querySelectorAll('.bg-image-item').forEach(item => {
                    item.addEventListener('click', () => { const bgImg = new Image(); bgImg.crossOrigin = "Anonymous"; bgImg.onload = () => { backgroundImage = bgImg; backgroundColor = 'transparent'; updateSelection(item, '.bg-image-item, .color-palette-item'); drawCanvas(); }; bgImg.src = item.dataset.bgSrc; });
                });
                backgroundUpload.addEventListener('change', (e) => {
                    const file = e.target.files[0]; if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (event) => { const bgImg = new Image(); bgImg.onload = () => { backgroundImage = bgImg; backgroundColor = 'transparent'; updateSelection(null, '.bg-image-item, .color-palette-item'); drawCanvas(); }; bgImg.src = event.target.result; };
                    reader.readAsDataURL(file);
                });
                document.querySelectorAll('.shadow-option').forEach(option => {
                    option.addEventListener('click', () => { currentShadow = option.dataset.shadow; updateSelection(option, '.shadow-option'); drawCanvas(); });
                });
                downloadBtn.addEventListener('click', () => { const link = document.createElement('a'); link.download = 'edited-image.png'; link.href = canvas.toDataURL('image/png'); link.click(); });
                window.addEventListener('resize', drawCanvas);
                setTimeout(drawCanvas, 0); 
            }
            
            // --- Animation Logic ---
            const starColors = ['#FFFFFF', '#FFD700', '#FFA07A', '#87CEEB', '#98FB98', '#FF69B4'];
            function generateAnimatedStars() {
                const animatedStarContainer = document.querySelector('#processing-animation-overlay .animated-star-container');
                if(!animatedStarContainer) return;
                animatedStarContainer.innerHTML = ''; 
                for (let i = 0; i < 60; i++) {
                    const star = document.createElement('div'); star.className = 'animated-star';
                    const size = Math.random() * 12 + 6;
                    star.style.width = `${size}px`; star.style.height = `${size}px`;
                    star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 100}%`;
                    star.style.animationDelay = `${Math.random() * 3}s`; star.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    const starColor = starColors[Math.floor(Math.random() * starColors.length)];
                    star.style.backgroundColor = starColor; star.style.boxShadow = `0 0 8px ${starColor}, 0 0 15px ${starColor}`;
                    animatedStarContainer.appendChild(star);
                }
            }
            function stopAnimatedStars() { 
                const animatedStarContainer = document.querySelector('#processing-animation-overlay .animated-star-container');
                if(animatedStarContainer) animatedStarContainer.innerHTML = ''; 
            }

            // --- History Logic ---
            function getHistory() { try { const history = localStorage.getItem('bgRemovalHistory'); return history ? JSON.parse(history) : []; } catch (e) { return []; } }
            function saveToHistory(base64data) { let history = getHistory(); history.unshift(base64data); if (history.length > 5) history = history.slice(0, 5); try { localStorage.setItem('bgRemovalHistory', JSON.stringify(history)); } catch (e) { console.error("Failed to save history:", e); } }
            function renderHistory() {
                const history = getHistory(); historyContainer.innerHTML = ''; 
                if (history.length === 0) { historyContainer.innerHTML = `<p class="text-gray-500">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú ‡¶®‡ßá‡¶á‡•§</p>`; } 
                else {
                    history.forEach(imageDataUrl => {
                        const img = document.createElement('img'); img.src = imageDataUrl; img.className = 'history-thumbnail'; img.alt = 'Saved work';
                        img.addEventListener('click', () => { 
                            const imageToEdit = new Image();
                            imageToEdit.onload = () => {
                                originalImage = imageToEdit;
                                showEditorView();
                                // Directly show final editor without processing animation
                                document.getElementById('processing-image-preview').classList.add('hidden');
                                document.getElementById('editor-ui').classList.remove('hidden');
                                drawCanvas();
                            };
                            imageToEdit.src = imageDataUrl;
                        });
                        historyContainer.appendChild(img);
                    });
                }
            }

            // --- Initial Setup for Static Parts ---
            const faqQuestions = document.querySelectorAll('.faq-question');
            faqQuestions.forEach(question => { question.addEventListener('click', () => { const answer = question.nextElementSibling; const arrow = question.querySelector('.faq-arrow'); const isOpening = answer.classList.contains('hidden'); document.querySelectorAll('.faq-answer').forEach(ans => { if (!ans.classList.contains('hidden') && ans !== answer) { ans.classList.add('hidden'); ans.previousElementSibling.querySelector('.faq-arrow').style.transform = 'rotate(0deg)'; } }); answer.classList.toggle('hidden'); arrow.style.transform = isOpening ? 'rotate(180deg)' : 'rotate(0deg)'; }); });
            showLandingView();
        });
    </script>
</body>
</html>

